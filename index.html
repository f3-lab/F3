<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–î–æ–º–∞—à–Ω—è—è –∫—É—Ö–Ω—è</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body {
font-family: -apple-system, BlinkMacSystemFont, sans-serif;
background: #f5f7fb;
margin: 0;
padding: 15px;
}

h1 {
text-align: center;
margin-bottom: 15px;
}

.category {
margin-top: 25px;
font-size: 18px;
font-weight: 600;
}

.card {
background: white;
padding: 15px;
margin-top: 10px;
border-radius: 16px;
box-shadow: 0 6px 14px rgba(0,0,0,0.05);
animation: fadeIn 0.3s ease;
}

select, input {
width: 100%;
padding: 10px;
margin-top: 8px;
border-radius: 10px;
border: 1px solid #ddd;
}

button {
width: 100%;
margin-top: 10px;
padding: 12px;
border-radius: 12px;
border: none;
background: #2AABEE;
color: white;
font-size: 15px;
font-weight: 500;
transition: 0.2s;
}

button:hover {
transform: scale(1.02);
}

.cart {
margin-top: 30px;
background: white;
padding: 15px;
border-radius: 16px;
box-shadow: 0 6px 14px rgba(0,0,0,0.05);
}

.remove {
background: #ff4d4f;
margin-top: 5px;
}

@keyframes fadeIn {
from { opacity:0; transform: translateY(10px);}
to { opacity:1; transform: translateY(0);}
}
</style>
</head>

<body>

<h1>ü•ü –î–æ–º–∞—à–Ω—è—è –∫—É—Ö–Ω—è</h1>
<div id="userInfo" style="font-size:14px;"></div>

<!-- –ü–ï–õ–¨–ú–ï–ù–ò -->
<div class="category">–ü–µ–ª—å–º–µ–Ω–∏</div>
<div class="card">
<select id="pelmeniType">
<option value="–°–≤–∏–Ω–∏–Ω–∞ –∏ –≥–æ–≤—è–¥–∏–Ω–∞|45">–°–≤–∏–Ω–∏–Ω–∞ –∏ –≥–æ–≤—è–¥–∏–Ω–∞ ‚Äî 45 R$</option>
<option value="–ö—É—Ä–∏—Ü–∞|40">–ö—É—Ä–∏—Ü–∞ ‚Äî 40 R$</option>
<option value="–ò–Ω–¥–µ–π–∫–∞|48">–ò–Ω–¥–µ–π–∫–∞ ‚Äî 48 R$</option>
</select>
<input type="number" id="pelmeniQty" value="1" min="1">
<button onclick="addItem('–ü–µ–ª—å–º–µ–Ω–∏','pelmeniType','pelmeniQty')">–î–æ–±–∞–≤–∏—Ç—å</button>
</div>

<!-- –í–ê–†–ï–ù–ò–ö–ò -->
<div class="category">–í–∞—Ä–µ–Ω–∏–∫–∏</div>
<div class="card">
<select id="varenikiType">
<option value="–ö–∞—Ä—Ç–æ—à–∫–∞|35">–ö–∞—Ä—Ç–æ—à–∫–∞ ‚Äî 35 R$</option>
<option value="–¢–≤–æ—Ä–æ–≥|38">–¢–≤–æ—Ä–æ–≥ ‚Äî 38 R$</option>
<option value="–í–∏—à–Ω—è|42">–í–∏—à–Ω—è ‚Äî 42 R$</option>
</select>
<input type="number" id="varenikiQty" value="1" min="1">
<button onclick="addItem('–í–∞—Ä–µ–Ω–∏–∫–∏','varenikiType','varenikiQty')">–î–æ–±–∞–≤–∏—Ç—å</button>
</div>

<!-- –ö–û–†–ó–ò–ù–ê -->
<div class="cart">
<h3>üõí –ö–æ—Ä–∑–∏–Ω–∞</h3>
<div id="cartItems"></div>
<strong>–ò—Ç–æ–≥–æ: <span id="total">0</span> R$</strong>

<button onclick="requestPhone()">üì± –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º</button>
<input id="phone" placeholder="–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –≤—Ä—É—á–Ω—É—é">
<input id="address" placeholder="–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏">

<button onclick="sendOrder()">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
</div>

<script>
let tg = window.Telegram.WebApp;
let userData = {};
if (tg) {
tg.expand();
userData = tg.initDataUnsafe?.user || {};
document.getElementById("userInfo").innerHTML =
"–í—ã –≤–æ—à–ª–∏ –∫–∞–∫: <b>" +
(userData.first_name || "") +
"</b> @" +
(userData.username || "–Ω–µ—Ç");
}

let cart = [];
let total = 0;

function addItem(category, selectId, qtyId) {
let select = document.getElementById(selectId);
let qty = parseInt(document.getElementById(qtyId).value);
let value = select.value.split("|");
let name = value[0];
let price = parseInt(value[1]);

cart.push({category,name,price,qty});
total += price * qty;

updateCart();
}

function updateCart() {
let div = document.getElementById("cartItems");
div.innerHTML = "";
total = 0;

cart.forEach((item,index) => {
let itemTotal = item.price * item.qty;
total += itemTotal;

div.innerHTML += `
<div style="margin-bottom:8px;">
${item.category} ‚Äî ${item.name} x${item.qty} = ${itemTotal} R$
<button class="remove" onclick="removeItem(${index})">–£–¥–∞–ª–∏—Ç—å</button>
</div>
`;
});

document.getElementById("total").innerText = total;
}

function removeItem(index) {
cart.splice(index,1);
updateCart();
}

function requestPhone(){
if(tg){
tg.requestContact();
}
}

function sendOrder(){
let phone = document.getElementById("phone").value;
let address = document.getElementById("address").value;

if(cart.length === 0){
alert("–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞—è");
return;
}

if(phone === "" || address === ""){
alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω –∏ –∞–¥—Ä–µ—Å");
return;
}

let orderData = {
user:{
id:userData.id || "",
name:userData.first_name || "",
username:userData.username || ""
},
phone: phone,
address: address,
items: cart,
total: total
};

tg.sendData(JSON.stringify(orderData));
}
</script>

</body>
</html>